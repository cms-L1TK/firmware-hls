# PRMEMC_Test

Working example of a chain consisting of one PR, eight ME, and one MC. The slice of the project that is used in this example is L3PHIC.

### How to open the project for the first time

This is how you open the project for the first time This will open the vivado GUI. After cloning the firmware-hls repository...

* Navigate to firmware-hls/IntegrationTests/PRMEMC_Test
* . buildproject.sh

### How to open the project after it has been built once

This will also open the vivado GUI.

* Navigate to firmware-hls/IntegrationTests/PRMEMC_Test
* vivado PRMEMC_Test/PRMEMC_Test.xpr

### How to run the behavioral simulation once vivado is open

(N.B. With the current version of generate_project.tcl, this happens automatically, so you don't have to do this the first time you build the project).

Flow -> Run Simulation -> Run Behavioral Simulation

There is currently a waveform saved in the repo called CurrentWaveform.wcfg, which will open automatially. It shows the bx in & out of the PR, the registers driving the number of entries in the input memories, many of the interesting ports for input & output memories, and the contents of the output memory BRAMs.

### How to incorporate a new version of an IP into the project

Suppose, for example, you want to make some changes to the PR IP and incorporate them into this test project. Here's what you need to do:

* Make the changes you want to make in
	* firmware-hls/TrackletAlgorithm/ProjectionRouter.hh
	* firmware-hls/TrackletAlgorithm/ProjectionRouterTop.h
	* firmware-hls/TrackletAlgorithm/ProjectionRouterTop.cpp
	* firmware-hls/TestBenches/ProjectionRouter_test.cpp
* Navigate to firmware-hls/project
* vivado_hls -f script_PR.tcl  
This will create a zip file at  
firmware-hls/project/projrouter/solution1/impl/ip/xilinx_com_hls_ProjectionRouterTop_1_0.zip

### Brief description of the contents of this part of the repo

* **firmware-hls/IntegrationTests/PRMEMC_Test/generate_project.tcl:** tlc script generated by vivado, used to generate the project for the first time.
* **firmware-hls/IntegrationTests/PRMEMC_Test/emData/download.sh:** Bash script to download and untar the data files that are needed to populate the input BRAMs in the test bench.
* **firmware-hls/project/:** Directory containing the HLS-generated IPs, generated by running script_PR.tcl, script_ME.tcl, and script_MC.tcl in the firmware-hls/project directory. This is where vivado looks to add the HLS blocks to its IP catalog.
* **firmware-hls/TrackletAlgorithm/Memory.v:** Verilog memory module used to store the contents of the memories between the processing steps, as well as the input & output memories in the test bench. Also stores the number of entries in the memories.
* **firmware-hls/TrackletAlgorithm/Memory.v:** Same as Memory.v, but for binned memories such as VMStubME.
* **firmware-hls/IntegrationTests/PR_Test/sourceFiles/uut.v:** Verilog top-level module which instantiates the many instances (in this test project, there are ten) of the HLS-generated processing block IPs.
* **firmware-hls/IntegrationTests/PR_Test/sourceFiles/testfixture.v:** Verilog test bench to test the verilog top-level (uut) module. Also instantiates the needed input & output memories and control signals.
